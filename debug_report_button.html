<!DOCTYPE html>
<html>
<head>
    <title>Debug Report Button</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1e1e1e; color: white; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; background: #2a2a2a; }
        button { margin: 5px; padding: 10px 15px; background: #2a5298; color: white; border: none; cursor: pointer; }
        pre { background: #000; color: #0f0; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç—á–µ—Ç–æ–≤</h1>
    
    <div class="test-section">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞</h3>
        <button onclick="checkJWT()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å JWT</button>
        <pre id="jwt-result"></pre>
    </div>
    
    <div class="test-section">
        <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è</h3>
        <button onclick="checkExtension()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ</button>
        <pre id="extension-result"></pre>
    </div>
    
    <div class="test-section">
        <h3>3. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–Ω–æ–ø–∫—É</h3>
        <button onclick="createTestButton()">–°–æ–∑–¥–∞—Ç—å –∫–Ω–æ–ø–∫—É</button>
        <pre id="button-result"></pre>
    </div>
    
    <div class="test-section">
        <h3>4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π JWT</h3>
        <button onclick="setTestJWT()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω—Å–∫–∏–π JWT</button>
        <pre id="set-jwt-result"></pre>
    </div>

    <script>
        function checkJWT() {
            const result = document.getElementById('jwt-result');
            const token = localStorage.getItem('jwt_token');
            
            if (!token) {
                result.textContent = 'JWT —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage';
                return;
            }
            
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                result.textContent = `JWT –Ω–∞–π–¥–µ–Ω:\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${payload.user}\n–†–æ–ª–∏: ${JSON.stringify(payload.roles)}\n–ò—Å—Ç–µ–∫–∞–µ—Ç: ${new Date(payload.exp * 1000).toLocaleString()}`;
            } catch (e) {
                result.textContent = `–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JWT: ${e.message}`;
            }
        }
        
        function checkExtension() {
            const result = document.getElementById('extension-result');
            
            if (typeof window.DoctorReportExtension === 'undefined') {
                result.textContent = 'DoctorReportExtension –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å...';
                
                const script = document.createElement('script');
                script.src = '/config/ohif/doctor-report-extension.js';
                script.onload = () => {
                    result.textContent += '\n–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞...';
                    if (window.DoctorReportExtension.hasPermission()) {
                        result.textContent += '\n‚úÖ –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤';
                    } else {
                        result.textContent += '\n‚ùå –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤';
                    }
                };
                script.onerror = () => {
                    result.textContent += '\n‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è';
                };
                document.head.appendChild(script);
            } else {
                result.textContent = 'DoctorReportExtension —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω!\n';
                if (window.DoctorReportExtension.hasPermission()) {
                    result.textContent += '‚úÖ –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤';
                } else {
                    result.textContent += '‚ùå –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤';
                }
            }
        }
        
        function createTestButton() {
            const result = document.getElementById('button-result');
            
            // Remove existing test button
            const existing = document.getElementById('doctor-report-floating-btn');
            if (existing) existing.remove();
            
            // Create floating button
            const floatingButton = document.createElement('button');
            floatingButton.id = 'doctor-report-floating-btn';
            floatingButton.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">üìã</span>
                    <span>–ó–∞–∫–ª—é—á–µ–Ω–∏–µ</span>
                </div>
            `;
            floatingButton.style.cssText = `
                position: fixed;
                top: 50%;
                right: 30px;
                z-index: 99999;
                background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
                color: white;
                border: none;
                padding: 16px 20px;
                border-radius: 50px;
                cursor: pointer;
                font-size: 14px;
                font-weight: bold;
                box-shadow: 0 8px 25px rgba(42, 82, 152, 0.4);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                transform: translateY(-50%);
                backdrop-filter: blur(10px);
                border: 2px solid rgba(255, 255, 255, 0.1);
                min-width: 140px;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            `;
            
            floatingButton.addEventListener('click', () => {
                alert('–¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç!');
            });
            
            document.body.appendChild(floatingButton);
            result.textContent = '‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–¥–Ω–∞ —Å–ø—Ä–∞–≤–∞';
        }
        
        function setTestJWT() {
            const result = document.getElementById('set-jwt-result');
            
            // Create a test JWT token for admin user
            const header = btoa(JSON.stringify({
                "typ": "JWT",
                "alg": "HS256"
            }));
            
            const payload = btoa(JSON.stringify({
                "user": "admin",
                "roles": ["admin", "doctor"],
                "exp": Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24 hours
            }));
            
            // This is a dummy signature - in real app it would be properly signed
            const signature = "dummy_signature_for_testing";
            
            const testToken = `${header}.${payload}.${signature}`;
            
            localStorage.setItem('jwt_token', testToken);
            localStorage.setItem('user_roles', JSON.stringify(['admin', 'doctor']));
            localStorage.setItem('username', 'admin');
            
            result.textContent = '‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π JWT —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å —Ä–æ–ª—è–º–∏ admin –∏ doctor\n–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç—á–µ—Ç–∞–º';
        }
    </script>
</body>
</html> 